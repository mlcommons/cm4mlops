# Collective Knowledge concept (CK)

[Collective Knowledge concept](https://arxiv.org/pdf/2011.01149.pdf) 
provides a simple way to unify, manage, connect and reuse any artifacts, scripts, tools and workflows 
on any platform with any software and hardware stack. It is motivated by our 
[tedious experience](https://learning.acm.org/techtalks/reproducibility) 
reproducing research papers on machine learning and systems and validating them in the real world.

<details>

*<summary>Click me to read more about the CK concept:</summary>*

We have developed CK to help researchers and developers turn their scripts, artifacts and workflow
into a database of portable, reusable, customizable and deterministic components
with minimal effort and no changes to their projects.

All such components have a simple, human-friendly and platform-independent CLI, Python API,
JSON or YAML meta description, tags, and Unique ID automatically generated by CK.

This approach allows users to automatically plug any ad-hoc scripts and artifacts 
from the community into their projects, build systems, CI/CD tools,
containers, Jupyter/Colab notebooks and any other technology.

CK runtime system also helps users interconnect any scripts and artifacts 
into portable workflows, applications and web-services.
They can run natively or inside containers while automatically 
adapting to any given software and hardware.

Any output of CK components and workflows (CSV/XLS/JSON/YAML files,
pre-processed data set, notes and optimized code) can be also stored 
as CK components with all related CM dependencies.
Such database-like organization of projects makes it easier
for the community to re-run, reproduce and reuse research results.

We have donated CK to the [MLCommons foundation](https://mlcommons.org) 
to benefit everyone after it was successfully validated by Qualcomm, Arm, General Motors,
OctoML, Krai, HPE, Dell, Lenovo and other organizations.

We continue improving and enhancing CK based on your feedback and requirements - 
feel free to join our [open workgroup](docs/mlperf-education-workgroup.md) 
to provide your feedback and participate in further developments!

</details>

&copy; 2021-2022 [MLCommons](https://mlcommons.org)<br>


## Collective Mind automation meta-framework 

Collective Mind workflow automation meta-framework (CM) is the 2nd implementation 
of the [CK concept](https://arxiv.org/pdf/2011.01149.pdf) developed
by the [open MLCommons taskforce on education and reproducibility](docs/mlperf-education-workgroup.md).
CM is used to modularize ML and AI systems and automate their benchmarking, 
optimization and deployment across continuously changing software, hardware and data.

[![License](https://img.shields.io/badge/License-Apache%202.0-green)](https://github.com/mlcommons/ck/tree/master/cm)
[![PyPI version](https://badge.fury.io/py/cmind.svg)](https://pepy.tech/project/cmind)
[![Python Version](https://img.shields.io/badge/python-3+-blue.svg)](https://github.com/mlcommons/ck/tree/master/cm)
[![CM(CK2) test](https://github.com/mlcommons/ck/actions/workflows/test-cm.yml/badge.svg)](https://github.com/mlcommons/ck/actions/workflows/test-cm.yml)



### Installation

The CM automation meta-framework is implemented as a small Python class with a CLI and minimal dependencies 
(python 3+ with pip, git and wget). It can be installed on any platform including Linux, Windows and MacOS
using PIP.

Here is a typical CM installation on Ubuntu 22.04:

```bash
sudo apt install python3 python3-pip git wget

python3 -m pip install cmind
```

Note that you may need to restart your shell to update PATH to the "cm" binary. 
Alternatively you can run 

```bash
source .profile
```

```
gfursin@mlcommons-ck-cm-dev:~$ cm

cm {action} {automation} {artifact(s)} {--flags} @input.yaml @input.json
```

You are ready to use the MLCommons CM automation meta-framework (aka CK2).

Please check the [CM installation guide](cm/docs/installation.md) 
to install system dependencies and CM on Linux, Windows, MacOS 
and other operating systems. 

If you encounter any problems, just open a ticket [here](https://github.com/mlcommons/ck/issues)
and we will get back to you!



### CM repositories with reusable and cross-platform components

CM allows users to add simple database-like interface to their existing Git repositories
to make it easier for the community to reuse their artifacts, scripts, tools and workflows.

The [MLCommons taskforce on education and reproducibility](docs/mlperf-education-workgroup.md) 
gradually turns existing artifacts and scripts from [reproduced ML and Systems papers](https://cknowledge.io/reproduced-papers) 
and [MLPerf benchmarks](https://github.com/mlcommons)
into cross-platform CM components using so-called [CM scripts](https://github.com/mlcommons/ck/tree/master/cm-mlops/script).
 
All these CM scripts has a unified API, CLI and JSON/YAML meta description to automatically download, install, build and interconnect
complex applications, models, data sets, engines, libraries, SDKs and tools for different platforms and operating systems.

You can install this repository (or any other repository with the "CM-compatible logo") as follows:

```bash
cm pull repo --url=https://github.com/mlcommons/ck
```

or

```bash
cm pull repo mlcommons@ck
```

You can then use the CM database interface to list, find, add, remove and update any portable CM script

```bash
cm list script

cm find script --tags=app,image-classification
```

You can also run any shared script on any platform via the CM runtime natively or inside a container as follows:

```bash
cm run script --tags=detect,os --out=json
```

You can run the same script similar to a unified micro-service or standalone app using CM Python API as follows:
```python
import cmind
r=cmind.access({'action':'run', 'automation':'script', 'tags':'get,os'})
print (r)
```

Such a unified CM interface makes it possible to automatically interconnect any public and private artifacts 
and automation scripts into portable applications and workflows as demonstrated in the next example.


### CM demo for portable and modular image classification

Here we demonstrate how to run a modular image classification workflow using CM. 
CM workflow is also a portable CM script that chains other [cross-platform CM scripts](https://github.com/mlcommons/ck/blob/master/cm-mlops/script) 
using a [simple and human friendly JSON/YAML description](https://github.com/octoml/ck/blob/master/cm-mlops/script/app-image-classification-onnx-py/_cm.yaml).

These CM scripts update global environments and a CM "state" dictionary similar to native scripts
while automatically detecting, downloading, installing and building all related artifacts
and tools to adapt this workflow to any user platform.

You can run the image classification workflow using CM CLI as follows:

```bash
cm run script --tags=python,app,image-classification,onnx --quiet
cm run script --tags=python,app,image-classification,onnx --input=my-image.jpg
```
or
```bash
cm run script "python app image-classification onnx" --quiet
cm run script "python app image-classification onnx" --input=my-image.jpg
```

or using Python interface for CM:
```python
import cmind
r=cmind.access({'action':'run', 'automation':'script'
                'tags':'app,image-classification,onnx,python',
                'quiet':True,
                'out':'con'})
print (r)
```

It may take a few minutes to run this workflow for the first time depending on the Internet speed
because CM will attempt to automatically detect or install all required components 
(sys utils, python, ONNX runtime, ResNet50 model, ImageNet validation set) while adapting them to your platform.

Note that all the subsequent runs will be much faster because CM automatically caches the output of all CM scripts
to be quickly reused by other CM scripts.

Note, that you can clean the CM cache and start from scratch using the following command:
```bash
cm rm cache -f
```

<details>

*<summary>Click me to see dependencies for this workflow (also CM scripts):</summary>*

* [Detect host OS properties](https://github.com/mlcommons/ck/tree/master/cm-mlops/script/detect-os) *(tags: detect,os)*
* [Install system utils](https://github.com/mlcommons/ck/tree/master/cm-mlops/script/get-sys-utils-cm) *(tags: get,sys-utils-cm)*
* [Detect or install python](https://github.com/mlcommons/ck/tree/master/cm-mlops/script/get-python3) *(tags: get,python3)*
* [Get small ImageNet validation dataset (500 images)](https://github.com/mlcommons/ck/tree/master/cm-mlops/script/get-dataset-imagenet-val) *(tags: get,dataset,imagenet,image-classification,original)*
* [Get ImageNet labels](https://github.com/mlcommons/ck/tree/master/cm-mlops/script/get-dataset-imagenet-aux) *(tags: get,dataset-aux,imagenet-aux,image-classification)*
* [Download ResNet50 model (ONNX)](https://github.com/mlcommons/ck/tree/master/cm-mlops/script/get-ml-model-resnet50-onnx) *(tags: get,ml-model,resnet50,_onnx,image-classification)*
* [Detect or install ONNX run-time](https://github.com/mlcommons/ck/tree/master/cm-mlops/script/get-generic-python-lib) *(tags: get,generic-python-lib,_onnxruntime)*

</details>



### CM tutorials


* [Digging into image classification CM workflow](cm/docs/example-modular-image-classification.md)
* [Understanding CM database and runtime interface](cm/docs/tutorial-concept.md)
* [Understanding cross-platform CM scripts](cm/docs/tutorial-scripts.md)
    * [Adding new artifacts, scripts and workflows to CM](cm/docs/tutorial-scripts.md#adding-new-artifacts-scripts-and-workflows-to-cm) 
* [Running and reproducing MLPerf inference benchmarks](docs/mlperf-cm-automation-demo.md)

### CM projects

* [Open MLCommons taskforce to automate co-design, benchmarking, optimization and deployment of ML Systems](docs/mlperf-education-workgroup.md)
* [Artifact evaluation and reproducibility initiatives at conferences](https://cTuning.org/ae)

### CM documentation

* [Table of contents](https://github.com/mlcommons/ck/tree/master/cm/docs)
* [Contributing to the MLCommons CM](CONTRIBUTING.md)


### CM resources and references

* [Motivation](cm/docs/motivation.md)
* [Journal article describing the CK concept](https://arxiv.org/pdf/2011.01149.pdf)
* ["Reproducing 150 Research Papers and Testing Them in the Real World" (ACM TechTalk; Feb 2021)](https://learning.acm.org/techtalks/reproducibility)
* [Blog article about "MLOps Is a Mess But That's to be Expected" (March 2022)](https://www.mihaileric.com/posts/mlops-is-a-mess)
* ["Automating MLPerf design space exploration and production deployment" (HPCA'22)](https://doi.org/10.5281/zenodo.6475385)
* ["Collaboratively Benchmarking and Optimizing Deep Learning Implementations" (General Motors; Jun 2017)]( https://youtu.be/1ldgVZ64hEI )
* [MLOps projects, articles and tools](https://github.com/mlcommons/ck/tree/master/cm/docs/KB/MLOps.md)

## Legacy MLCommons CK framework

*Please check [this page](ck1) to get the legacy MLCommons CK framework v2.6.1
that was discontinued in summer 2022 after the stable release of the 2nd generation of this framework
(CM aka CK2).
Please join the [MLCommons taskforce](docs/mlperf-education-workgroup.md) 
if you need help to convert your old [CK components and workflows for MLOps](https://github.com/mlcommons/ck-mlops)
to the new CM format.*


## Maintainers

* [Grigori Fursin](https://cKnowledge.io/cf@gfursin) and [Arjun Suresh](https://www.linkedin.com/in/arjunsuresh) 
  ([OctoML](https://octoml.ai) and [MLCommons](https://mlcommons.org))

## Acknowledgments

This project is supported by [MLCommons](https://mlcommons.org), [OctoML](https://octoml.ai) 
and [individual contributors](https://github.com/mlcommons/ck/blob/master/CONTRIBUTING.md).

